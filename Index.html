<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cascais Treasure Hunt</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Comic Sans MS', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .login-screen { display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .login-box {
            background: white; padding: 40px; border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            text-align: center; max-width: 400px; width: 100%;
        }
        .login-box h1 { color: #667eea; margin-bottom: 10px; font-size: 2.5em; }
        .login-box p { color: #666; margin-bottom: 30px; }
        .team-buttons { display: flex; flex-direction: column; gap: 15px; }
        .team-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white; border: none; padding: 15px 30px;
            border-radius: 10px; font-size: 1.2em; cursor: pointer;
            font-family: inherit; transition: transform 0.2s;
        }
        .team-btn:hover { transform: translateY(-2px); }
        .team-btn.red { background: linear-gradient(135deg, #f5576c 0%, #e74c3c 100%); }
        .team-btn.blue { background: linear-gradient(135deg, #667eea 0%, #4e54c8 100%); }
        .team-btn.green { background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%); }
        .team-btn.admin { background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%); color: #333; }
        header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 30px 20px; text-align: center; border-radius: 20px;
            margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); position: relative;
        }
        header h1 { color: white; font-size: 2.5em; text-shadow: 3px 3px 6px rgba(0,0,0,0.3); }
        .team-name { color: white; font-size: 1.3em; margin-top: 10px; }
        .logout-btn {
            position: absolute; top: 20px; right: 20px;
            background: rgba(255,255,255,0.2); color: white;
            border: 2px solid white; padding: 8px 20px;
            border-radius: 20px; cursor: pointer; font-family: inherit;
        }
        .progress-section {
            background: white; padding: 25px; border-radius: 15px;
            margin-bottom: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        .progress-bar {
            background: #e0e0e0; height: 30px; border-radius: 15px;
            overflow: hidden; margin-top: 15px;
        }
        .progress-fill {
            background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
            height: 100%; transition: width 0.5s ease;
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold;
        }
        .rewards-display {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px; margin-top: 20px;
        }
        .reward-card {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            padding: 15px; border-radius: 10px; text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        .reward-card .icon { font-size: 2em; margin-bottom: 5px; }
        .reward-card .value { font-size: 1.5em; font-weight: bold; color: #d63031; }
        .reward-card .label { font-size: 0.9em; color: #666; }
        .clue-container {
            background: white; padding: 30px; border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2); margin-bottom: 20px;
        }
        .clue-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; flex-wrap: wrap; gap: 15px;
        }
        .clue-number-badge {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white; width: 50px; height: 50px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5em; font-weight: bold;
        }
        .clue-type {
            background: #667eea; color: white; padding: 8px 20px; border-radius: 20px;
        }
        .clue-content h3 { color: #667eea; font-size: 1.8em; margin-bottom: 15px; }
        .clue-text {
            background: #e3f2fd; padding: 20px; border-radius: 10px;
            margin: 15px 0; border-left: 5px solid #667eea;
            font-size: 1.1em; line-height: 1.8;
        }
        .hint-section {
            background: #f5f5f5; padding: 20px; border-radius: 10px;
            margin-top: 20px; border: 2px dashed #999;
        }
        .hint-locked { text-align: center; padding: 20px; }
        .hint-locked .lock-icon { font-size: 2em; margin-bottom: 10px; }
        .hint-unlocked {
            background: #ffebee; padding: 15px; border-radius: 8px; color: #666;
        }
        .unlock-hint-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white; border: none; padding: 12px 30px;
            border-radius: 10px; font-size: 1em; cursor: pointer;
            margin-top: 10px; font-family: inherit;
        }
        .locked-clue {
            background: #f5f5f5; padding: 30px; border-radius: 15px;
            text-align: center; color: #999;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1); margin-bottom: 20px;
        }
        .locked-clue .lock-icon { font-size: 3em; margin-bottom: 10px; }
        .challenge-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px; margin-top: 15px;
        }
        .challenge-card {
            padding: 20px; border-radius: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2); position: relative;
        }
        .challenge-card.incomplete {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 3px solid #ffc107;
        }
        .challenge-card.complete {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border: 3px solid #28a745;
        }
        .challenge-checkmark {
            position: absolute; top: 10px; right: 10px; font-size: 2em;
        }
        .admin-panel {
            background: white; padding: 30px; border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2); margin-bottom: 20px;
        }
        .admin-panel h2 { color: #667eea; margin-bottom: 20px; }
        .team-control {
            background: #f5f5f5; padding: 20px; border-radius: 10px; margin-bottom: 15px;
        }
        .team-control h3 { color: #f5576c; margin-bottom: 15px; }
        .clue-controls {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px; margin-top: 10px;
        }
        .clue-control-btn {
            padding: 10px; border-radius: 8px; border: none;
            cursor: pointer; font-family: inherit; font-size: 0.9em;
        }
        .clue-control-btn.unlocked { background: #96c93d; color: white; }
        .clue-control-btn.locked { background: #e0e0e0; color: #666; }
        .reset-btn {
            background: #e74c3c; color: white; border: none;
            padding: 10px 20px; border-radius: 8px; cursor: pointer;
            margin-top: 10px; font-family: inherit;
        }
        .completion-message {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            padding: 40px; border-radius: 15px; text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2); margin: 30px 0;
        }
        .completion-message h2 { color: #d63031; font-size: 2.5em; margin-bottom: 15px; }
        @media (max-width: 768px) {
            .logout-btn { position: static; margin-top: 15px; }
            header h1 { font-size: 1.8em; }
        }
    </style>
</head>
<body>
    <div id="app">Loading...</div>
    <script>
        // ============================================================
        // üîê PASSWORDS - CHANGE THESE!
        // ============================================================
        const teamPasswords = {
            pirates: "pirates123",
            explorers: "explorers345",
            adventurers: "adventurers567",
            admin: "admin2025"
        };

        // ============================================================
        // üìç YOUR 10 CLUES - EDIT THESE!
        // ============================================================
        const allClues = [
            // CLUE 0
            {
                type: "üß© Riddle",
                title: "I know Cascais inside out!",
                clueText: "I‚Äôm neighbours with a place that wakes you up, But I trade no beans, no eclair, no cup.Instead I deal in maps and secrets of the shore ‚Äî For your next clue come through my door. Ask the person behind the counter for your next clue",
                hint: "üí° Want a hint! Use your credit",
                reward: { type: "hint", value: 1 }
            },
            // CLUE 1
            {
                type: "üß© Riddle ",
                title: "Colorful Memories",
                clueText: "Seek the page with the cover art. The page also happens to be the square of a single-digit number. There, the artist talks about a place he‚Äôd love to exhibit his work, just 200m from his house! There lies your next clue!",
                hint: "üí° Want a hint! Use your credit",
                reward: { type: "hint", value: 2 }
            },
            // CLUE 2
            {
                type: "üßÆ Riddle",
                title: "Old Man and the Sea",
                clueText: "I have two eyes but cannot see alone, I help you view things far from home. Hold me up, look through me tight, I make distant objects come into sight. An old man holds me, scanning the sea, A tall sail drifts right in front of me. A giant anchor rests close by, Just a few steps away ‚Äî no need to fly!",
                hint: "üí° Want a hint! Use your credit",
                reward: { type: "hint", value: 3 }
            },
            // CLUE 3
            {
                type: " Photo",
                title: "Click clickty click",
                clueText: "Open Clue Alpha in your Dosier!",
                reward: { type: "points", value: 50 }
            },
            // CLUE 4
            {
                type: "üß≠ Photo!",
                title: "You will find her in Copenhagen too",
                clueText: "By the edge of the sea sits a figure so still, Watching the waves roll in as they will. She‚Äôs half-story, half-statue, gazing far and free ‚Äî Find the watcher who never stops looking at the sea.",
                reward: { type: "time", value: 10 }
            },
            // CLUE 5
            {
                type: "üìö History Hunt",
                title: "Light the Way",
                clueText: "The pride of Cascais, I stand by the ocean where the waves meet the land, Striped in pajama colours, tall, proud, and grand. I‚Äôve watched over sailors for many a night, Guiding them safely with my blinking light.  But you won‚Äôt need to travel far to the cliffs to find me. My little clones are waiting nearby in 3D. Just look around‚Ä¶ and click the one that looks like me!",
                reward: { type: "hint", value: 1 }
            },
            // CLUE 6
            {
                type: "üëÄ Zoo time",
                title: "Merry time",
                clueText: "Come summer or winter, we‚Äôve been spinning in circles for as long as we can remember, and honestly, even zoo cages sound calmer than this endless whirl. Come rescue us, please! Take a selfie with each of us, and we‚Äôll reveal your next clue",
                reward: { type: "points", value: 100 }
            },
            // CLUE 7
            {
                type: "üé≠ Connection",
                title: "Welcome to Cascias",
                clueText: "Open Clue# 3. Along the way, you can earn minutes - One minute per photograph but you have to get it write. Beneath the huge STARry lights on the cobbled lane, Three clicks I await for your next clue to gain. One photo for each, all in sight, And your next clue will come to light! Warm and cozy, soft on your toes,  Find 50 pairs of this object lined in neat rows. Shiny tins from the deep blue sea, Capture 100 or more sardine cans for me! Tiny sparkles that dangle off your ears and gleam, Snap 100 pairs or more of these to complete the theme!",
                reward: { type: "time", value: 15 }
            },
            // CLUE 8
            {
                type: "üèõÔ∏è A litte math puzzle!",
                title: "Cheers",
                clueText: "Nandini loves to Netflix and chill in her room with a kid-friendly bubbly drink. Her room is a big rectangular space, five and a half metres wide and four metres long. We‚Äôre planning a small makeover for her space to make it cozy for the winters - we want to cover the whole floor with one-square-metre carpet tiles. They can even be cut in half, if required, to fit the room How many tiles do we need to order? And that my little ladies is your next clue!",
                hint: "üí° I Read it more than once for more hints!",
                reward: { type: "hint", value: 3 }
            },
            // CLUE 9
            {
                type: "üèÜ Final Challenge",
                title: "The Ultimate Discovery",
                clueText: "A little Portuguese test, come give it a whirl, Name the three primary colours in this colourful world. Now take away the one that never makes roxo true, The colour that‚Äôs left? It‚Äôs the one that paints this rua! Spot it, and skip with a twirl, Head to the restaurant that represents the country of the birthday girl!",
                reward: { type: "completion", value: 0 }
            }
        ];

        // ============================================================
        // üéÅ BONUS CHALLENGES - EDIT THESE!
        // ============================================================
        const bonusChallenges = [
            {
                id: 1,
                title: "üì∏ Find TWO Light Arches",
                description: "Take a photo with TWO arches with atleast one of you under it!",
                reward: 1,
                icon: "üèõÔ∏è"
            },
            {
                id: 2,
                title: "üé® Spot TWO Building murals",
                description: "Click pictures and sent it to earn a hint!",
                reward: 1,
                icon: "üé®"
            },
            {
                id: 3,
                title: "üêï Spot TWO pastel de nata shops",
                description: "With owner permission!",
                reward: 1,
                icon: "üêï"
            },
            {
                id: 4,
                title: "üó£Ô∏è Sing happy birthday Nandini loudly on the streets",
                description: "Record & send!",
                reward: 1,
                icon: "üó£Ô∏è"
            },
            {
                id: 5,
                title: "üåä Find the tallest christmas tree in Cascais - not a typical one",
                description: "Team pic!",
                reward: 1,
                icon: "üåä"
            }
        ];

        // ============================================================
        // GAME STATE - Different routes for each team!
        // ============================================================
        let gameState = {
            currentUser: null,
            teams: {
                pirates: {
                    name: "üè¥‚Äç‚ò†Ô∏è Pirates",
                    color: "#e74c3c",
                    unlockedClues: [0],
                    unlockedHints: [],
                    completedChallenges: [],
                    route: [0, 3, 1, 6, 2, 8, 4, 7, 5, 9],  // Different order!
                    rewards: { hints: 0, timeMinutes: 0, points: 0 }
                },
                explorers: {
                    name: "üó∫Ô∏è Explorers",
                    color: "#3498db",
                    unlockedClues: [0],
                    unlockedHints: [],
                    completedChallenges: [],
                    route: [1, 4, 6, 2, 8, 0, 7, 3, 9, 5],  // Different order!
                    rewards: { hints: 0, timeMinutes: 0, points: 0 }
                },
                adventurers: {
                    name: "‚öì Adventurers",
                    color: "#27ae60",
                    unlockedClues: [0],
                    unlockedHints: [],
                    completedChallenges: [],
                    route: [2, 5, 8, 1, 7, 4, 0, 9, 6, 3],  // Different order!
                    rewards: { hints: 0, timeMinutes: 0, points: 0 }
                }
            }
        };

        // Clear corrupted data
        try {
            const test = localStorage.getItem('cascaisTreasureHunt');
            if (test) JSON.parse(test);
        } catch(e) {
            localStorage.removeItem('cascaisTreasureHunt');
        }

        // SAVE/LOAD
        function loadState() {
            try {
                const saved = localStorage.getItem('cascaisTreasureHunt');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    if (parsed.teams) gameState.teams = parsed.teams;
                    gameState.currentUser = parsed.currentUser || null;
                }
            } catch(e) {
                localStorage.removeItem('cascaisTreasureHunt');
            }
        }

        function saveState() {
            try {
                localStorage.setItem('cascaisTreasureHunt', JSON.stringify(gameState));
            } catch(e) {
                console.error('Save error:', e);
            }
        }

        // LOGIN
        function showPasswordPrompt(teamId) {
            const teamNames = {
                pirates: "üè¥‚Äç‚ò†Ô∏è Pirates Team",
                explorers: "üó∫Ô∏è Explorers Team",
                adventurers: "‚öì Adventurers Team",
                admin: "üîë Admin Control"
            };
            const password = prompt('Enter password for ' + teamNames[teamId] + ':');
            if (password === null) return;
            if (password === teamPasswords[teamId]) {
                gameState.currentUser = teamId;
                saveState();
                render();
            } else {
                alert("‚ùå Incorrect password!");
            }
        }

        function logout() {
            gameState.currentUser = null;
            saveState();
            render();
        }

        function useHintToken(teamId, routePosition) {
            const team = gameState.teams[teamId];
            if (team.rewards.hints > 0) {
                team.rewards.hints -= 1;
                if (!team.unlockedHints.includes(routePosition)) {
                    team.unlockedHints.push(routePosition);
                }
                saveState();
                render();
            }
        }

        // RENDER LOGIN
        function renderLogin() {
            return '<div class="login-screen"><div class="login-box">' +
                '<h1>üè¥‚Äç‚ò†Ô∏è Cascais Treasure Hunt</h1>' +
                '<p>Select your team and enter password!</p>' +
                '<div class="team-buttons">' +
                '<button class="team-btn red" onclick="showPasswordPrompt(\'pirates\')">üè¥‚Äç‚ò†Ô∏è Pirates Team</button>' +
                '<button class="team-btn blue" onclick="showPasswordPrompt(\'explorers\')">üó∫Ô∏è Explorers Team</button>' +
                '<button class="team-btn green" onclick="showPasswordPrompt(\'adventurers\')">‚öì Adventurers Team</button>' +
                '<div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #eee;">' +
                '<button class="team-btn admin" onclick="showPasswordPrompt(\'admin\')">üîë Admin Control</button>' +
                '</div></div></div></div>';
        }

        // RENDER TEAM
        function renderTeam(teamId) {
            const team = gameState.teams[teamId];
            const currentClueIndex = team.unlockedClues.length - 1;
            const currentRoutePosition = team.unlockedClues[currentClueIndex];
            const actualClueIndex = team.route[currentRoutePosition];
            const progress = (team.unlockedClues.length / 10) * 100;
            const isComplete = team.unlockedClues.length > 10;
            
            let html = '<div class="container">' +
                '<header style="background: linear-gradient(135deg, ' + team.color + ' 0%, #764ba2 100%);">' +
                '<button class="logout-btn" onclick="logout()">Logout</button>' +
                '<h1>üè¥‚Äç‚ò†Ô∏è Cascais Treasure Hunt</h1>' +
                '<div class="team-name">' + team.name + '</div>' +
                '</header>' +
                '<div class="progress-section">' +
                '<h2 style="color: ' + team.color + ';">Your Progress</h2>' +
                '<div class="progress-bar">' +
                '<div class="progress-fill" style="width: ' + progress + '%">' + Math.floor(progress) + '%</div>' +
                '</div>' +
                '<p style="margin-top: 10px; text-align: center; color: #666;">Clue ' + team.unlockedClues.length + ' of 10</p>' +
                '<div class="rewards-display">' +
                '<div class="reward-card"><div class="icon">üí°</div><div class="value">' + team.rewards.hints + '</div><div class="label">Hints</div></div>' +
                '<div class="reward-card"><div class="icon">‚è±Ô∏è</div><div class="value">' + team.rewards.timeMinutes + '</div><div class="label">Minutes</div></div>' +
                '<div class="reward-card"><div class="icon">‚≠ê</div><div class="value">' + team.rewards.points + '</div><div class="label">Points</div></div>' +
                '</div></div>';

            // Bonus challenges
            html += '<div class="progress-section"><h2 style="color: ' + team.color + ';">üéÅ Bonus Challenges</h2>' +
                '<p style="color: #666; margin-bottom: 15px;">Complete these for extra hints!</p>' +
                '<div class="challenge-grid">';
            
            bonusChallenges.forEach(function(challenge) {
                const isCompleteChallenge = team.completedChallenges.includes(challenge.id);
                html += '<div class="challenge-card ' + (isCompleteChallenge ? 'complete' : 'incomplete') + '">' +
                    (isCompleteChallenge ? '<div class="challenge-checkmark">‚úÖ</div>' : '') +
                    '<div style="font-size: 2.5em; margin-bottom: 10px;">' + challenge.icon + '</div>' +
                    '<h4>' + challenge.title + '</h4>' +
                    '<p style="color: #666; font-size: 0.9em; margin: 10px 0;">' + challenge.description + '</p>' +
                    '<div style="background: ' + (isCompleteChallenge ? '#28a745' : '#ff9800') + '; color: white; padding: 8px; border-radius: 8px; text-align: center; font-weight: bold;">' +
                    (isCompleteChallenge ? 'COMPLETED! (+' + challenge.reward + ' üí°)' : 'Reward: ' + challenge.reward + ' Hint' + (challenge.reward > 1 ? 's' : '')) +
                    '</div></div>';
            });
            
            html += '</div></div>';

            if (isComplete) {
                html += '<div class="completion-message">' +
                    '<h2>üéâ Congratulations! üéâ</h2>' +
                    '<p style="font-size: 1.3em; margin-top: 15px;">You completed the Cascais Treasure Hunt!</p>' +
                    '<div style="margin-top: 20px; font-size: 1.2em;">' +
                    '<p><strong>Final Stats:</strong></p>' +
                    '<p>üí° Hints: ' + team.rewards.hints + '</p>' +
                    '<p>‚è±Ô∏è Time: ' + team.rewards.timeMinutes + ' min</p>' +
                    '<p>‚≠ê Points: ' + team.rewards.points + '</p>' +
                    '</div>' +
                    '<p style="font-size: 1.5em; margin-top: 20px;">üèÜ Report to the organizer! üèÜ</p>' +
                    '</div>';
            } else {
                // Current clue
                const clue = allClues[actualClueIndex];
                const hintUnlocked = team.unlockedHints.includes(currentRoutePosition);

                html += '<div class="clue-container">' +
                    '<div class="clue-header">' +
                    '<div class="clue-number-badge">' + (currentRoutePosition + 1) + '</div>' +
                    '<span class="clue-type">' + clue.type + '</span>' +
                    '</div>' +
                    '<div class="clue-content">' +
                    '<h3>' + clue.title + '</h3>' +
                    '<div class="clue-text">' + clue.clueText + '</div>' +
                    '<div class="hint-section">';

                if (hintUnlocked) {
                    html += '<div class="hint-unlocked">' + clue.hint + '</div>';
                } else {
                    html += '<div class="hint-locked">' +
                        '<div class="lock-icon">üîí</div>' +
                        '<h4>Hint Locked!</h4>' +
                        '<p style="margin: 10px 0; color: #666;">' +
                        (team.rewards.hints > 0 ? 'Use a hint token to unlock!' : 'Earn hints by completing clues!') +
                        '</p>';

                    if (team.rewards.hints > 0) {
                        html += '<p style="color: #00b09b; margin: 10px 0; font-size: 1.2em; font-weight: bold;">' +
                            'üí° You have ' + team.rewards.hints + ' hint token' + (team.rewards.hints > 1 ? 's' : '') + '!' +
                            '</p>' +
                            '<button class="unlock-hint-btn" onclick="useHintToken(\'' + teamId + '\', ' + currentRoutePosition + ')">üí° Use 1 Hint Token</button>';
                    } else {
                        html += '<p style="color: #999; margin: 10px 0; font-style: italic;">Complete more clues to earn hints!</p>';
                    }
                    html += '</div>';
                }

                html += '<div style="text-align: center;">' +
                    '<p style="color: #666; margin-top: 20px;">‚ö†Ô∏è Send proof to organizer to unlock next clue! ‚ö†Ô∏è</p>' +
                    '</div></div>';

                // Locked clues
                for (let i = currentRoutePosition + 1; i < 10; i++) {
                    html += '<div class="locked-clue">' +
                        '<div class="lock-icon">üîí</div>' +
                        '<h3>Clue ' + (i + 1) + '</h3>' +
                        '<p>Complete current clue to unlock!</p>' +
                        '</div>';
                }
            }

            html += '</div>';
            return html;
        }

        // RENDER ADMIN
        function renderAdmin() {
            let html = '<div class="container"><header>' +
                '<button class="logout-btn" onclick="logout()">Logout</button>' +
                '<h1>üîë Admin Control Panel</h1>' +
                '</header>';

            Object.keys(gameState.teams).forEach(function(teamId) {
                const team = gameState.teams[teamId];
                html += '<div class="admin-panel">' +
                    '<div class="team-control">' +
                    '<h3>' + team.name + '</h3>' +
                    '<p>Progress: ' + team.unlockedClues.length + ' / 10 clues</p>' +
                    '<p style="color: #666; margin-top: 5px;">üí° ' + team.rewards.hints + ' | ‚è±Ô∏è ' + team.rewards.timeMinutes + ' min | ‚≠ê ' + team.rewards.points + ' pts</p>' +
                    '<div class="clue-controls">';

                for (let i = 0; i < 10; i++) {
                    const isUnlocked = team.unlockedClues.includes(i);
                    const hasHint = team.unlockedHints.includes(i);
                    html += '<button class="clue-control-btn ' + (isUnlocked ? 'unlocked' : 'locked') + '" ' +
                        'onclick="toggleClue(\'' + teamId + '\', ' + i + ')">' +
                        (isUnlocked ? '‚úì' : 'üîí') + ' #' + (i + 1) + (hasHint ? ' üí°' : '') +
                        '</button>';
                }

                html += '</div>';

                // Bonus challenges
                html += '<div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #ddd;">' +
                    '<h4 style="color: #667eea; margin-bottom: 10px;">üéÅ Bonus Challenges</h4>' +
                    '<div style="display: grid; gap: 10px;">';

                bonusChallenges.forEach(function(challenge) {
                    const isCompleted = team.completedChallenges.includes(challenge.id);
                    html += '<button class="clue-control-btn ' + (isCompleted ? 'unlocked' : 'locked') + '" ' +
                        'onclick="toggleChallenge(\'' + teamId + '\', ' + challenge.id + ')" ' +
                        'style="text-align: left; padding: 12px;">' +
                        (isCompleted ? '‚úÖ' : '‚¨ú') + ' ' + challenge.icon + ' ' + challenge.title +
                        '<span style="float: right; font-weight: bold;">+' + challenge.reward + 'üí°</span>' +
                        '</button>';
                });

                html += '</div></div>' +
                    '<button class="reset-btn" onclick="resetTeam(\'' + teamId + '\')">Reset ' + team.name + '</button>' +
                    '</div></div>';
            });

            html += '<div class="admin-panel">' +
                '<h2 style="color: #e74c3c;">Danger Zone</h2>' +
                '<button class="reset-btn" onclick="resetAll()" style="font-size: 1.1em; padding: 15px 30px;">Reset All Teams</button>' +
                '</div></div>';

            return html;
        }

        // ACTIONS
        function toggleClue(teamId, clueIndex) {
            const team = gameState.teams[teamId];
            const idx = team.unlockedClues.indexOf(clueIndex);
            
            if (idx > -1) {
                team.unlockedClues.splice(idx, 1);
            } else {
                if (!team.unlockedClues.includes(clueIndex)) {
                    team.unlockedClues.push(clueIndex);
                    team.unlockedClues.sort(function(a, b) { return a - b; });
                    
                    // Award rewards
                    if (clueIndex > 0) {
                        const prevRoutePos = clueIndex - 1;
                        const prevActualClue = team.route[prevRoutePos];
                        const reward = allClues[prevActualClue].reward;
                        
                        if (reward.type === 'hint') {
                            team.rewards.hints += reward.value;
                        } else if (reward.type === 'time') {
                            team.rewards.timeMinutes += reward.value;
                        } else if (reward.type === 'points') {
                            team.rewards.points += reward.value;
                        }
                    }
                }
            }
            
            saveState();
            render();
        }

        function toggleChallenge(teamId, challengeId) {
            const team = gameState.teams[teamId];
            const idx = team.completedChallenges.indexOf(challengeId);
            
            if (idx > -1) {
                team.completedChallenges.splice(idx, 1);
                const challenge = bonusChallenges.find(function(c) { return c.id === challengeId; });
                team.rewards.hints -= challenge.reward;
            } else {
                team.completedChallenges.push(challengeId);
                const challenge = bonusChallenges.find(function(c) { return c.id === challengeId; });
                team.rewards.hints += challenge.reward;
            }
            
            saveState();
            render();
        }

        function resetTeam(teamId) {
            if (confirm('Reset ' + gameState.teams[teamId].name + '?')) {
                gameState.teams[teamId].unlockedClues = [0];
                gameState.teams[teamId].unlockedHints = [];
                gameState.teams[teamId].completedChallenges = [];
                gameState.teams[teamId].rewards = { hints: 0, timeMinutes: 0, points: 0 };
                saveState();
                render();
            }
        }

        function resetAll() {
            if (confirm('Reset ALL teams? Cannot be undone!')) {
                Object.keys(gameState.teams).forEach(function(teamId) {
                    gameState.teams[teamId].unlockedClues = [0];
                    gameState.teams[teamId].unlockedHints = [];
                    gameState.teams[teamId].completedChallenges = [];
                    gameState.teams[teamId].rewards = { hints: 0, timeMinutes: 0, points: 0 };
                });
                saveState();
                render();
            }
        }

        // RENDER
        function render() {
            const app = document.getElementById('app');
            try {
                if (!gameState.currentUser) {
                    app.innerHTML = renderLogin();
                } else if (gameState.currentUser === 'admin') {
                    app.innerHTML = renderAdmin();
                } else {
                    app.innerHTML = renderTeam(gameState.currentUser);
                }
            } catch(e) {
                console.error('Render error:', e);
                app.innerHTML = '<div style="color: white; text-align: center; padding: 50px;">' +
                    '<h2>Error</h2><p>Please refresh</p></div>';
            }
        }

        // INIT
        try {
            loadState();
            render();
        } catch(e) {
            console.error('Init error:', e);
        }
    </script>
</body>
</html>
